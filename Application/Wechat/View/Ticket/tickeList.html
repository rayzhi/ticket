<extend name="template/template" />

<block name="css">
	<style type="text/css">
	  
	</style>
</block>

<block name="content">

 <body>
 
	 <form id="h-form" method="post" enctype="multipart/form-data" action="javascript:;" >
	    <div class="panel margin-top">
	        <h3 class="maintext ticketName">{$areaName}魔乐城场馆体验票</h3>
	        <p class="mainprice">￥<span id="price">{$ticketInfo.price}</span></p>
	        <input type="hidden" name="ticket_type_id" value="{$ticketInfo.ticketTypeId}" />	        
	    </div>
	
	    <div class="panel margin-top" href="#">
	        <select name="venues_id" class="selectarea required">
	        	<empty name="venuesinfo">
	        		<option value="">暂无场地</option>
	        	<else />
	        		<option value="">请选择场地</option>
	        		<volist name="venuesinfo" id="vo">
	        			<option value="{$vo.id}">{$vo.name}</option>
	        		</volist>
	        	</empty>
	        </select>
	        <div class="selectnum">
	            <span class="text">数量</span>
	            <div class="numer margin-left30">
	                <span class="minus">-</span>
	                <input type="text" name="amount" class="numval" value="1">
	                <span class="plus">+</span>
	            </div>
	        </div>
	    </div>
	
	    <div class="margin-top30">&nbsp;</div>
	    <div class="container">
	    	<button type="submit" class="btn-block margin-top">立即购买</button>
	    </div>
	</form>
  </body>
</block>


<block name="script">
	<script>
		
		//提交表单
		$('.btn-block').click(function(){
			price = Number($('#price').html());
			if(price <= 0) return alert('票价必须大于0哦');
			ticketName = $('.ticketName').html();
			if($("#h-form").valid()){
				var index = layer.load(0,{shade:[0.3,'#676767']});
				data = $("form").serialize();
				data = data+'&price='+price+'&ticketName='+ticketName;
				$.post(
					"{:UC('Wechat/Ticket/makeOrder')}", 
					data, 
				    function(obj){
						if(obj.status == 1){
							window.location.href = "{:UC('Wechat/Ticket/sureOrder')}?order_id="+obj.url;
						}else{
							alert(data.info);
							layer.close(index);
						}
					},
					'json'
				);
			}
		})
		
		$('.plus').click(function(){
			numval = Number($('.numval').val())+1;
			$('.numval').val(numval);
		})
		
		$('.minus').click(function(){
			numval = Number($('.numval').val());
			if(numval > 1) $('.numval').val(numval-1);
		})
		
	</script>
</block>

